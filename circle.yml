machine:
  services:
  - docker

dependencies:
  cache_directories:
  - "~/bitnami-docker-apache"
  override:
  - docker info
  - docker build --rm=false -t experimental/apache .

test:
  override:
  - docker info
  - if [[ -e ~/bitnami-docker-apache/image.tar ]]; then docker load --input ~/bitnami-docker-apache/image.tar; fi
  - docker run -it experimental/apache nami list
  - mkdir -p ~/bitnami-docker-apache; docker save --output ~/bitnami-docker-apache/image.tar experimental/apache

deployment:
  hub:
    branch: master
    commands:
      - printenv
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
      - docker push experimental/apache
